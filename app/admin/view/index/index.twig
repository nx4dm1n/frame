<!DOCTYPE html>
<html lang="ch">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <meta http-equiv='cache-control' content='no-cache'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>

    <!--<link rel="shortcut icon" href="{{static_url}}quirk/images/favicon.png" type="image/png">-->

    <title>{{ site_name }}</title>

    <link rel="stylesheet" href="{{static_url}}quirk/lib/Hover/hover.css">
    <link rel="stylesheet" href="{{static_url}}quirk/lib/fontawesome/css/font-awesome.css">
    <link rel="stylesheet" href="{{static_url}}quirk/lib/weather-icons/css/weather-icons.css">
    <link rel="stylesheet" href="{{static_url}}quirk/lib/ionicons/css/ionicons.css">
    <link rel="stylesheet" href="{{static_url}}quirk/lib/jquery-toggles/toggles-full.css">

    <link rel="stylesheet" href="{{static_url}}quirk/css/quirk.css">
    <link rel="stylesheet" href="{{static_url}}quirk/css/custom.css">

    <script src="{{static_url}}quirk/lib/modernizr/modernizr.js"></script>
    <script src="{{static_url}}quirk/lib/jquery/jquery.js"></script>
    <script src="{{static_url}}quirk/lib/jquery-ui/jquery-ui.js"></script>
    <script src="{{static_url}}quirk/lib/bootstrap/js/bootstrap.js"></script>
    <script src="{{static_url}}quirk/lib/jquery-toggles/toggles.js"></script>
    <script src="{{static_url}}quirk/js/core.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="{{static_url}}quirk/lib/html5shiv/html5shiv.js"></script>
    <script src="{{static_url}}quirk/lib/respond/respond.src.js"></script>
    <![endif]-->

    <!--script data-main="{{static_url}}quirk/main" defer async="true" src="{{static_url}}quirk/lib/require/require.js"></script-->
</head>

<body>

<header>
    <div class="headerpanel">

        <div class="logopanel">
            <h2><a href="{{ webroot_path }}admin/index/index.html">{{ site_name }}</a></h2>
        </div><!-- logopanel -->

        <div class="headerbar">

            <a id="menuToggle" class="menutoggle"><i class="fa fa-bars"></i></a>

            <div class="header-right">
                <ul class="headermenu">
                    <li>
                        <div class="btn-group">
                            <button type="button" class="btn btn-logged" data-toggle="dropdown">
                                <img src="{% if user.pic %}{{ user.pic }}{% else %}{{static_url}}quirk/images/photos/loggeduser.png{% endif %}" alt="" />
                                {{ user.username }}
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu pull-right">
                                <li><a href="{{ webroot_path }}admin/user/show/id/{{ user.id }}.html" class="ajax-link"><i class="glyphicon glyphicon-user"></i> 个人资料</a></li>
                                <li><a href="{{ webroot_path }}admin/user/show/id/{{ user.id }}.html" class="ajax-link"><i class="glyphicon glyphicon-user"></i> 修改密码</a></li>
                                <li><a href="{{ webroot_path }}admin/public/login_out.html"><i class="glyphicon glyphicon-log-out"></i> 退出登录</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div><!-- header-right -->
        </div><!-- headerbar -->
    </div><!-- header-->
</header>

<section>
    <div class="leftpanel">
        <div class="leftpanelinner">
            {% if user.is_root %}
            <ul class="nav nav-tabs nav-justified nav-sidebar">
                <li class="tooltips active" data-toggle="tooltip" title="菜单列表"><a data-toggle="tab" data-target="#mainmenu"><i class="tooltips fa fa-ellipsis-h"></i></a></li>
                <li class="tooltips" data-toggle="tooltip" title="用户管理"><a data-toggle="tab" data-target="#user"><i class="fa fa-user"></i></a></li>
                <li class="tooltips" data-toggle="tooltip" title="系统设置"><a data-toggle="tab" data-target="#settings"><i class="fa fa-cog"></i></a></li>
            </ul>
            {% endif %}

            <div class="tab-content">
                <!-- ################# MAIN MENU ################### -->
                <div class="tab-pane active" id="mainmenu">
                    <ul class="nav nav-pills nav-stacked nav-quirk">
                        {% autoescape false %}
                            {{ menuhtml }}
                        {% endautoescape %}
                    </ul>
                </div><!-- tab-pane -->
                {% if user.is_root %}
                <!-- #################### USER ################### -->
                <div class="tab-pane" id="user">
                    <ul class="nav nav-pills nav-stacked nav-quirk nav-mail">
                        <li><a href="{{ webroot_path }}admin/user/index.html" class="ajax-link"><i class="fa fa-users"></i> <span>用户管理</span></a></li>
                    </ul>
                </div><!-- tab-pane -->

                <!-- #################### SETTINGS ################### -->
                <div class="tab-pane" id="settings">
                    <ul class="nav nav-pills nav-stacked nav-quirk nav-mail">
                        <li><a href="{{ webroot_path }}admin/setting/menu_index.html" class="ajax-link"><i class="fa fa-bars"></i> <span>栏目管理</span></a></li>
                        <li><a href="{{ webroot_path }}admin/setting/config_index.html" class="ajax-link"><i class="glyphicon glyphicon-wrench"></i> <span>常规设置</span></a></li>
                    </ul>
                </div><!-- tab-pane -->
                {% endif %}
            </div><!-- tab-content -->
        </div><!-- leftpanelinner -->
    </div><!-- leftpanel -->

    <div class="mainpanel" id="ajax-content">
        <div class="contentpanel">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="panel panel-success">
                        <div class="panel-heading">
                            <h3 class="panel-title">欢迎回来</h3>
                        </div>
                        <div class="panel-body">
                            <p>&nbsp;</p>
                            <p>{{ user.username }} 登录次数 <strong>{{ user.hits }}</strong></p>
                            <p>&nbsp;</p>
                        </div>
                    </div><!-- panel -->
                </div><!-- col-sm-6 -->
            </div>
        </div>
    </div><!-- mainpanel -->
</section>


<script>
    $(document).ready(function(){
        /**
         * 显示/隐藏 左侧面板
         */
        $('#menuToggle').click(function() {
            var collapsedMargin = $('.mainpanel').css('margin-left');
            var collapsedLeft   = $('.mainpanel').css('left');

            if(collapsedMargin === '220px' || collapsedLeft === '220px') {
                toggleMenu(-220,0);
            } else {
                toggleMenu(0,220);
            }
        });

        function toggleMenu(marginLeft, marginMain) {
            var emailList = ($(window).width() <= 768 && $(window).width() > 640)? 320 : 360;

            if($('.mainpanel').css('position') === 'relative') {
                $('.logopanel, .leftpanel').animate({left: marginLeft}, 'fast');
                $('.headerbar, .mainpanel').animate({left: marginMain}, 'fast');

                $('.emailcontent, .email-options').animate({left: marginMain}, 'fast');
                $('.emailpanel').animate({left: marginMain + emailList}, 'fast');

                if($('body').css('overflow') == 'hidden') {
                    $('body').css({overflow: ''});
                } else {
                    $('body').css({overflow: 'hidden'});
                }
            } else {
                $('.logopanel, .leftpanel').animate({marginLeft: marginLeft}, 'fast');
                $('.headerbar, .mainpanel').animate({marginLeft: marginMain}, 'fast');
                $('.emailcontent, .email-options').animate({left: marginMain}, 'fast');
                $('.emailpanel').animate({left: marginMain + emailList}, 'fast');
            }
        }

        /**
         * a标签所有带有ajax-link样式的进行ajax请求
         */
        $(document).on('click','a', function(e){
            if ($(this).hasClass('ajax-link')) {
                e.preventDefault();
                var url     = $(this).attr('href');
                var target  = $(this).attr('data-href-target')!==undefined ? $(this).attr('data-href-target') : '#ajax-content';
                $.LoadAjaxContent(url, target);
            }
        });

        /**
         * 后台管理页面-左侧菜单点击 高亮(active)标识
         */
        $(document).on('click', '#mainmenu ul.children li', function(){
            $('#mainmenu .active').removeClass('active');
            $(this).addClass('active');
            $(this).parents('li.nav-parent').addClass('active');
        });

        /**
         * Tooltip
         */
        $('.tooltips').tooltip({ container: 'body'});

        /**
         * Toggle Left Menu
         */
        $('.nav-parent > a').on('click', function() {
            var gran = $(this).closest('.nav');
            var parent = $(this).parent();
            var sub = parent.find('> ul');

            if(sub.is(':visible')) {
                sub.slideUp(200);
                if(parent.hasClass('nav-active')) { parent.removeClass('nav-active'); }
            } else {
                $(gran).find('.children').each(function() {
                    $(this).slideUp();
                });

                sub.slideDown(200);
                if(!parent.hasClass('active')) { parent.addClass('nav-active'); }
            }
            return false;
        });

        /**
         * #ajax-content 导航菜单 激活样式
         */
        $(document).on('click', '#ajax-content .btn-group a', function(){
            $(this).prevAll().removeClass('btn-success');
            $(this).nextAll().removeClass('btn-success');
            $(this).addClass('btn-success');
        });
    });
</script>
</body>
</html>
